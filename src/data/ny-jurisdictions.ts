import { Jurisdiction } from '@/types/sales-tax';

// Metropolitan Commuter Transportation District (MCTD) counties
export const MCTD_COUNTIES = [
  'New York', 'Bronx', 'Kings', 'Queens', 'Richmond', // NYC boroughs
  'Rockland', 'Nassau', 'Suffolk', 'Orange', 'Putnam',
  'Dutchess', 'Westchester'
];

// NY Sales Tax Jurisdictions - Complete Rate Table
export const NY_JURISDICTIONS: Jurisdiction[] = [
  // State Level
  {
    code: 'NY',
    name: 'New York State',
    level: 'state',
    stateRate: 4.0,
    localRate: 0,
    mctdRate: 0,
    combinedRate: 4.0,
    inMCTD: false,
    effectiveDate: '2024-01-01',
    clothingExemption: true, // State 4% is always exempt for clothing under $110
  },

  // NYC (5 boroughs)
  {
    code: 'NY-NYC',
    name: 'New York City',
    level: 'city',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.5,
    mctdRate: 0.375,
    combinedRate: 8.875,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true, // NYC provides the local clothing exemption
    zipCodes: ['10001', '10002', '10003', '10004', '10005', '10006', '10007', '10008', '10009', '10010', '10011', '10012', '10013', '10014', '10016', '10017', '10018', '10019', '10020', '10021', '10022', '10023', '10024', '10025', '10026', '10027', '10028', '10029', '10030', '10031', '10032', '10033', '10034', '10035', '10036', '10037', '10038', '10039', '10040', '10044', '10065', '10069', '10075', '10103', '10110', '10111', '10112', '10115', '10119', '10128', '10152', '10153', '10154', '10162', '10165', '10166', '10167', '10168', '10169', '10170', '10171', '10172', '10173', '10174', '10177', '10199', '10271', '10278', '10279', '10280', '10282', '11201', '11203', '11204', '11205', '11206', '11207', '11208', '11209', '11210', '11211', '11212', '11213', '11214', '11215', '11216', '11217', '11218', '11219', '11220', '11221', '11222', '11223', '11224', '11225', '11226', '11228', '11229', '11230', '11231', '11232', '11233', '11234', '11235', '11236', '11237', '11238', '11239', '10451', '10452', '10453', '10454', '10455', '10456', '10457', '10458', '10459', '10460', '10461', '10462', '10463', '10464', '10465', '10466', '10467', '10468', '10469', '10470', '10471', '10472', '10473', '10474', '10475', '11101', '11102', '11103', '11104', '11105', '11106', '11354', '11355', '11356', '11357', '11358', '11359', '11360', '11361', '11362', '11363', '11364', '11365', '11366', '11367', '11368', '11369', '11370', '11371', '11372', '11373', '11374', '11375', '11377', '11378', '11379', '11385', '11411', '11412', '11413', '11414', '11415', '11416', '11417', '11418', '11419', '11420', '11421', '11422', '11423', '11426', '11427', '11428', '11429', '11430', '11432', '11433', '11434', '11435', '11436', '10301', '10302', '10303', '10304', '10305', '10306', '10307', '10308', '10309', '10310', '10312', '10314'],
  },

  // MCTD Counties - All provide clothing exemption
  {
    code: 'NY-NASSAU',
    name: 'Nassau County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.25,
    mctdRate: 0.375,
    combinedRate: 8.625,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['11001', '11003', '11010', '11020', '11021', '11023', '11024', '11030', '11040', '11042', '11050', '11051', '11052', '11053', '11054', '11055', '11096', '11501', '11507', '11509', '11510', '11514', '11516', '11518', '11520', '11530', '11531', '11542', '11545', '11547', '11548', '11549', '11550', '11551', '11552', '11553', '11554', '11556', '11557', '11558', '11559', '11560', '11561', '11563', '11565', '11566', '11568', '11569', '11570', '11571', '11572', '11575', '11576', '11577', '11579', '11580', '11581', '11590', '11596', '11598', '11599', '11709', '11710', '11714', '11732', '11735', '11753', '11756', '11758', '11762', '11765', '11771', '11773', '11783', '11791', '11793', '11797', '11801', '11802', '11803', '11804', '11815', '11819', '11853', '11854', '11855'],
  },
  {
    code: 'NY-SUFFOLK',
    name: 'Suffolk County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.25,
    mctdRate: 0.375,
    combinedRate: 8.625,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['11701', '11702', '11703', '11704', '11705', '11706', '11713', '11715', '11716', '11717', '11718', '11719', '11720', '11721', '11722', '11724', '11725', '11726', '11727', '11729', '11730', '11731', '11733', '11738', '11739', '11740', '11741', '11742', '11743', '11746', '11747', '11749', '11750', '11751', '11752', '11754', '11755', '11757', '11760', '11763', '11764', '11766', '11767', '11768', '11769', '11770', '11772', '11775', '11776', '11777', '11778', '11779', '11780', '11782', '11784', '11786', '11787', '11788', '11789', '11790', '11792', '11794', '11795', '11796', '11798', '11901', '11930', '11931', '11932', '11933', '11934', '11935', '11937', '11939', '11940', '11941', '11942', '11944', '11946', '11947', '11948', '11949', '11950', '11951', '11952', '11953', '11954', '11955', '11956', '11957', '11958', '11959', '11960', '11961', '11962', '11963', '11964', '11965', '11967', '11968', '11969', '11970', '11971', '11972', '11973', '11975', '11976', '11977', '11978', '11980'],
  },
  {
    code: 'NY-WESTCHESTER',
    name: 'Westchester County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0.375,
    combinedRate: 8.375,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['10501', '10502', '10503', '10504', '10505', '10506', '10507', '10509', '10510', '10511', '10512', '10514', '10516', '10517', '10518', '10519', '10520', '10521', '10522', '10523', '10524', '10526', '10527', '10528', '10530', '10532', '10533', '10535', '10536', '10537', '10538', '10540', '10541', '10543', '10545', '10546', '10547', '10548', '10549', '10550', '10551', '10552', '10553', '10560', '10562', '10566', '10567', '10570', '10573', '10576', '10577', '10578', '10579', '10580', '10583', '10588', '10589', '10590', '10591', '10594', '10595', '10596', '10597', '10598', '10601', '10602', '10603', '10604', '10605', '10606', '10607', '10610', '10701', '10702', '10703', '10704', '10705', '10706', '10707', '10708', '10709', '10710', '10801', '10802', '10803', '10804', '10805'],
  },
  {
    code: 'NY-ROCKLAND',
    name: 'Rockland County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0.375,
    combinedRate: 8.375,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['10901', '10911', '10913', '10920', '10923', '10927', '10931', '10952', '10954', '10956', '10960', '10962', '10964', '10965', '10968', '10970', '10974', '10976', '10977', '10980', '10983', '10984', '10986', '10989', '10993', '10994'],
  },
  {
    code: 'NY-PUTNAM',
    name: 'Putnam County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0.375,
    combinedRate: 8.375,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['10509', '10512', '10516', '10524', '10537', '10541', '10579', '10588', '10597'],
  },
  {
    code: 'NY-DUTCHESS',
    name: 'Dutchess County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0.375,
    combinedRate: 8.375,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['12501', '12502', '12503', '12504', '12506', '12507', '12508', '12511', '12512', '12514', '12515', '12518', '12520', '12522', '12524', '12525', '12526', '12527', '12528', '12531', '12533', '12537', '12538', '12540', '12545', '12546', '12549', '12551', '12564', '12567', '12569', '12570', '12571', '12572', '12574', '12575', '12578', '12580', '12581', '12582', '12583', '12585', '12590', '12592', '12594', '12601', '12602', '12603', '12604'],
  },
  {
    code: 'NY-ORANGE',
    name: 'Orange County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0.375,
    combinedRate: 8.375,
    inMCTD: true,
    effectiveDate: '2024-01-01',
    clothingExemption: true,
    zipCodes: ['10310', '10314', '10901', '10910', '10911', '10912', '10914', '10915', '10916', '10917', '10918', '10919', '10920', '10921', '10922', '10924', '10925', '10926', '10928', '10930', '10932', '10940', '10941', '10943', '10949', '10950', '10953', '10958', '10959', '10963', '10969', '10973', '10975', '10979', '10981', '10985', '10987', '10988', '10990', '10992', '10996', '10997', '10998', '12518', '12520', '12543', '12549', '12550', '12551', '12552', '12553', '12555', '12566', '12575', '12577', '12584', '12586', '12589', '12729', '12746', '12771', '12779', '12780'],
  },

  // Non-MCTD Counties - Most do NOT provide clothing exemption (local tax applies)
  {
    code: 'NY-ALBANY',
    name: 'Albany County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0,
    combinedRate: 8.0,
    inMCTD: false,
    effectiveDate: '2024-01-01',
    clothingExemption: false, // Local tax applies to clothing under $110
    zipCodes: ['12007', '12009', '12023', '12041', '12045', '12046', '12047', '12054', '12055', '12059', '12067', '12077', '12084', '12085', '12107', '12110', '12120', '12128', '12143', '12144', '12147', '12158', '12159', '12161', '12183', '12186', '12189', '12193', '12201', '12202', '12203', '12204', '12205', '12206', '12207', '12208', '12209', '12210', '12211', '12212', '12214', '12220', '12222', '12223', '12224', '12225', '12226', '12227', '12228', '12229', '12230', '12231', '12232', '12233', '12234', '12235', '12236', '12237', '12238', '12239', '12240', '12241', '12242', '12243', '12244', '12245', '12246', '12247', '12248', '12249', '12250', '12252', '12255', '12256', '12257', '12260', '12261', '12288'],
  },
  {
    code: 'NY-ERIE',
    name: 'Erie County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0,
    combinedRate: 8.0,
    inMCTD: false,
    effectiveDate: '2024-01-01',
    clothingExemption: false, // Local tax applies to clothing under $110
    zipCodes: ['14001', '14004', '14006', '14010', '14025', '14026', '14027', '14030', '14031', '14032', '14033', '14034', '14035', '14036', '14038', '14043', '14047', '14051', '14052', '14055', '14057', '14059', '14061', '14068', '14069', '14072', '14075', '14080', '14085', '14086', '14091', '14102', '14110', '14111', '14112', '14120', '14127', '14134', '14139', '14140', '14141', '14150', '14170', '14201', '14202', '14203', '14204', '14205', '14206', '14207', '14208', '14209', '14210', '14211', '14212', '14213', '14214', '14215', '14216', '14217', '14218', '14219', '14220', '14221', '14222', '14223', '14224', '14225', '14226', '14227', '14228', '14231', '14233', '14240', '14241', '14260', '14261', '14263', '14264', '14265', '14267', '14269', '14270', '14272', '14273', '14276', '14280'],
  },
  {
    code: 'NY-MONROE',
    name: 'Monroe County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0,
    combinedRate: 8.0,
    inMCTD: false,
    effectiveDate: '2024-01-01',
    clothingExemption: false, // Local tax applies to clothing under $110
    zipCodes: ['14410', '14420', '14428', '14445', '14450', '14464', '14467', '14468', '14472', '14502', '14506', '14508', '14514', '14519', '14526', '14534', '14543', '14546', '14559', '14564', '14580', '14586', '14602', '14603', '14604', '14605', '14606', '14607', '14608', '14609', '14610', '14611', '14612', '14613', '14614', '14615', '14616', '14617', '14618', '14619', '14620', '14621', '14622', '14623', '14624', '14625', '14626', '14627', '14638', '14639', '14642', '14643', '14644', '14645', '14646', '14647', '14649', '14650', '14651', '14652', '14653', '14692', '14694'],
  },
  {
    code: 'NY-ONONDAGA',
    name: 'Onondaga County',
    level: 'county',
    parentCode: 'NY',
    stateRate: 4.0,
    localRate: 4.0,
    mctdRate: 0,
    combinedRate: 8.0,
    inMCTD: false,
    effectiveDate: '2024-01-01',
    clothingExemption: false, // Local tax applies to clothing under $110
    zipCodes: ['13020', '13027', '13029', '13031', '13039', '13041', '13057', '13060', '13064', '13066', '13078', '13080', '13082', '13084', '13088', '13090', '13104', '13108', '13110', '13112', '13116', '13119', '13120', '13137', '13138', '13152', '13153', '13158', '13159', '13164', '13166', '13201', '13202', '13203', '13204', '13205', '13206', '13207', '13208', '13209', '13210', '13211', '13212', '13214', '13215', '13217', '13218', '13219', '13220', '13221', '13224', '13225', '13235', '13244', '13251', '13252', '13261', '13290'],
  },
];

// ZIP code to jurisdiction mapping
export const ZIP_TO_JURISDICTION: Record<string, string> = {};

// Build the ZIP to jurisdiction map
NY_JURISDICTIONS.forEach(j => {
  if (j.zipCodes) {
    j.zipCodes.forEach(zip => {
      ZIP_TO_JURISDICTION[zip] = j.code;
    });
  }
});

export function getJurisdictionByZip(zipCode: string): Jurisdiction | null {
  const code = ZIP_TO_JURISDICTION[zipCode];
  if (code) {
    return NY_JURISDICTIONS.find(j => j.code === code) || null;
  }
  // Default to state level if ZIP not found
  return NY_JURISDICTIONS.find(j => j.code === 'NY') || null;
}

export function getJurisdictionByCode(code: string): Jurisdiction | null {
  return NY_JURISDICTIONS.find(j => j.code === code) || null;
}

export function getAllCounties(): Jurisdiction[] {
  return NY_JURISDICTIONS.filter(j => j.level === 'county' || j.level === 'city');
}
