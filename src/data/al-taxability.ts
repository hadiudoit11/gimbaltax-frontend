import { TaxCategory, TaxabilityRule } from '@/types/sales-tax';

export const AL_TAX_CATEGORIES: TaxCategory[] = [
  {
    id: 'food',
    name: 'Food & Groceries',
    icon: 'ðŸŽ',
    description: 'Food products, groceries, and prepared meals',
    rules: [
      {
        id: 'food-grocery-reduced',
        category: 'Food & Groceries',
        subcategory: 'SNAP-Eligible Food',
        description: 'Food eligible for SNAP (Supplemental Nutrition Assistance Program)',
        taxable: true,
        exemptionType: 'partial',
        tbReference: 'Act 2025-305',
        tbUrl: 'https://www.revenue.alabama.gov/notice-state-sales-and-use-tax-rate-reduced-on-food-beginning-september-1-2025/',
        notes: 'Taxed at reduced state rate of 2% (effective Sept 1, 2025). Local taxes still apply at full rate. SNAP-eligible includes most grocery items for home consumption.',
      },
      {
        id: 'prepared-food',
        category: 'Food & Groceries',
        subcategory: 'Prepared Food',
        description: 'Prepared meals, restaurant food, hot/ready-to-eat food',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Taxed at full 4% state rate plus local taxes. Does NOT qualify for reduced grocery rate.',
      },
      {
        id: 'candy',
        category: 'Food & Groceries',
        subcategory: 'Candy & Confectionery',
        description: 'Candy, confectionery, and sweets',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Full state and local rates apply. Candy is not SNAP-eligible.',
      },
      {
        id: 'soft-drinks',
        category: 'Food & Groceries',
        subcategory: 'Beverages',
        description: 'Soft drinks, soda, carbonated beverages',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Full state and local rates apply. Soft drinks are not SNAP-eligible.',
      },
      {
        id: 'alcohol',
        category: 'Food & Groceries',
        subcategory: 'Alcoholic Beverages',
        description: 'Beer, wine, liquor',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Fully taxable at 4% state rate plus local taxes. Not SNAP-eligible.',
      },
      {
        id: 'vending-food',
        category: 'Food & Groceries',
        subcategory: 'Vending Machine Food',
        description: 'Food sold through vending machines',
        taxable: true,
        tbReference: 'Ala. Admin. Code 810-6-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/tax-rates/',
        notes: 'State rate is 3% for food vending. Local rates may vary.',
      },
    ],
  },
  {
    id: 'clothing',
    name: 'Clothing & Apparel',
    icon: 'ðŸ‘•',
    description: 'Wearing apparel, footwear, and accessories',
    rules: [
      {
        id: 'clothing-general',
        category: 'Clothing & Apparel',
        subcategory: 'General Clothing',
        description: 'All clothing, apparel, and footwear',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Alabama has NO general exemption for clothing. Full 4% state rate plus local taxes apply year-round.',
      },
      {
        id: 'clothing-tax-holiday',
        category: 'Clothing & Apparel',
        subcategory: 'Back-to-School Items',
        description: 'Clothing items under $156 during annual tax-free weekend (late July)',
        taxable: false,
        exemptionType: 'threshold',
        threshold: 156,
        conditions: ['Only during designated tax-free weekend', 'Items must be $156 or less per article'],
        tbReference: 'Alabama Back-to-School Sales Tax Holiday',
        tbUrl: 'https://www.revenue.alabama.gov/',
        notes: 'Annual tax holiday typically in late July. State and most local taxes waived. Check dates each year.',
      },
    ],
  },
  {
    id: 'digital',
    name: 'Digital Products & Software',
    icon: 'ðŸ’»',
    description: 'Software, digital downloads, SaaS, and streaming',
    rules: [
      {
        id: 'canned-software-tangible',
        category: 'Digital Products & Software',
        subcategory: 'Pre-written Software',
        description: 'Pre-written (canned) software on physical media',
        taxable: true,
        tbReference: 'Ex parte Russell County Community Hospital',
        tbUrl: 'https://www.revenue.alabama.gov/ador-issues-guidance-on-taxability-of-computer-software/',
        notes: 'Alabama Supreme Court ruled all computer software is tangible personal property and taxable.',
      },
      {
        id: 'canned-software-download',
        category: 'Digital Products & Software',
        subcategory: 'Pre-written Software',
        description: 'Pre-written (canned) software downloaded electronically',
        taxable: true,
        tbReference: 'Ex parte Russell County Community Hospital',
        tbUrl: 'https://www.revenue.alabama.gov/ador-issues-guidance-on-taxability-of-computer-software/',
        notes: 'Delivery method is irrelevant - electronic downloads of pre-written software are taxable.',
      },
      {
        id: 'custom-software',
        category: 'Digital Products & Software',
        subcategory: 'Custom Software',
        description: 'Custom software developed specifically for one client',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Admin. Code 810-6-1',
        tbUrl: 'https://www.revenue.alabama.gov/ador-issues-guidance-on-taxability-of-computer-software/',
        notes: 'Charges for true custom software development are generally not taxable as they constitute a service.',
      },
      {
        id: 'saas',
        category: 'Digital Products & Software',
        subcategory: 'SaaS',
        description: 'Software as a Service (cloud-based subscriptions)',
        taxable: true,
        conditions: ['Generally taxable', 'Some ambiguity in guidance'],
        tbReference: 'Ex parte Russell County Community Hospital',
        tbUrl: 'https://www.revenue.alabama.gov/ador-issues-guidance-on-taxability-of-computer-software/',
        notes: 'Based on 2019 AL Supreme Court ruling, SaaS is generally considered taxable. Consult with ADOR for specific situations.',
      },
      {
        id: 'digital-downloads',
        category: 'Digital Products & Software',
        subcategory: 'Digital Downloads',
        description: 'Digital music, movies, e-books, and other digital goods',
        taxable: true,
        tbReference: 'Ala. Admin. Code 810-6-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Delivery form is irrelevant - digital goods treated same as physical tangible property.',
      },
      {
        id: 'streaming-services',
        category: 'Digital Products & Software',
        subcategory: 'Streaming',
        description: 'Video/audio streaming services (Netflix, Spotify, etc.)',
        taxable: true,
        tbReference: 'Ala. Admin. Code 810-6-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Alabama generally taxes streaming services as access to tangible personal property.',
      },
    ],
  },
  {
    id: 'medical',
    name: 'Medical & Health',
    icon: 'ðŸ’Š',
    description: 'Prescription drugs, medical equipment, and health products',
    rules: [
      {
        id: 'prescription-drugs',
        category: 'Medical & Health',
        subcategory: 'Prescription Drugs',
        description: 'Prescription medications',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Prescription drugs are fully exempt from Alabama sales tax.',
      },
      {
        id: 'otc-drugs',
        category: 'Medical & Health',
        subcategory: 'OTC Medications',
        description: 'Over-the-counter medications (aspirin, cold medicine)',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'OTC medications are TAXABLE in Alabama - unlike prescription drugs.',
      },
      {
        id: 'medical-equipment',
        category: 'Medical & Health',
        subcategory: 'Medical Equipment',
        description: 'Durable medical equipment (wheelchairs, oxygen equipment)',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Most medical equipment is taxable unless specifically exempted or prescribed.',
      },
      {
        id: 'prosthetics',
        category: 'Medical & Health',
        subcategory: 'Prosthetics',
        description: 'Prosthetic devices when prescribed',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Must be prescribed by licensed practitioner'],
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Prosthetics are exempt when prescribed by a licensed practitioner.',
      },
    ],
  },
  {
    id: 'services',
    name: 'Services & Labor',
    icon: 'ðŸ”§',
    description: 'Repair services, installation, and labor charges',
    rules: [
      {
        id: 'repair-labor',
        category: 'Services & Labor',
        subcategory: 'Repair Labor',
        description: 'Labor charges for repair services',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Must be separately stated on invoice', 'Must be for repair/restoration only'],
        tbReference: 'Ala. Admin. Code 810-6-1-.84',
        tbUrl: 'https://www.law.cornell.edu/regulations/alabama/Ala-Admin-Code-r-810-6-1-.84',
        notes: 'Repair labor is EXEMPT if separately itemized. Parts are always taxable.',
      },
      {
        id: 'installation-labor',
        category: 'Services & Labor',
        subcategory: 'Installation Labor',
        description: 'Labor charges for installation',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Must be separately stated on invoice'],
        tbReference: 'Ala. Admin. Code 810-6-1-.84',
        tbUrl: 'https://www.law.cornell.edu/regulations/alabama/Ala-Admin-Code-r-810-6-1-.84',
        notes: 'Installation labor is EXEMPT if separately itemized on the invoice.',
      },
      {
        id: 'fabrication-labor',
        category: 'Services & Labor',
        subcategory: 'Fabrication Labor',
        description: 'Labor to fabricate, make, or produce new items',
        taxable: true,
        tbReference: 'Ala. Admin. Code 810-6-1-.84',
        tbUrl: 'https://www.law.cornell.edu/regulations/alabama/Ala-Admin-Code-r-810-6-1-.84',
        notes: 'Fabrication labor is ALWAYS taxable regardless of how it is invoiced.',
      },
      {
        id: 'combined-labor-parts',
        category: 'Services & Labor',
        subcategory: 'Combined Charges',
        description: 'Labor and parts combined without separate itemization',
        taxable: true,
        tbReference: 'Ala. Admin. Code 810-6-1-.84',
        tbUrl: 'https://www.law.cornell.edu/regulations/alabama/Ala-Admin-Code-r-810-6-1-.84',
        notes: 'If labor is NOT separately stated, the entire charge (labor + parts) is taxable.',
      },
      {
        id: 'professional-services',
        category: 'Services & Labor',
        subcategory: 'Professional Services',
        description: 'Legal, accounting, consulting, medical services',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Most professional services are not subject to Alabama sales tax.',
      },
    ],
  },
  {
    id: 'automotive',
    name: 'Automotive',
    icon: 'ðŸš—',
    description: 'Vehicles, parts, and automotive services',
    rules: [
      {
        id: 'automobile-sales',
        category: 'Automotive',
        subcategory: 'Vehicle Sales',
        description: 'Sale of automobiles and motor vehicles',
        taxable: true,
        exemptionType: 'partial',
        tbReference: 'Ala. Code Â§ 40-23-61',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/tax-rates/',
        notes: 'Automobiles are taxed at REDUCED state rate of 2% (not 4%). Local taxes still apply.',
      },
      {
        id: 'auto-parts',
        category: 'Automotive',
        subcategory: 'Parts & Accessories',
        description: 'Automotive parts and accessories',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Auto parts are taxed at full 4% state rate plus local taxes.',
      },
      {
        id: 'auto-repair-labor',
        category: 'Automotive',
        subcategory: 'Repair Labor',
        description: 'Labor for automotive repair and maintenance',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Must be separately stated on invoice'],
        tbReference: 'Ala. Admin. Code 810-6-1-.07',
        tbUrl: 'https://www.revenue.alabama.gov/wp-content/uploads/2021/12/810-6-1-.07.pdf',
        notes: 'Auto repair labor exempt if separately itemized. Parts always taxable.',
      },
      {
        id: 'gasoline',
        category: 'Automotive',
        subcategory: 'Fuel',
        description: 'Gasoline and motor oil',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Gasoline and motor oil are EXEMPT from sales tax (but subject to motor fuel excise taxes).',
      },
      {
        id: 'kerosene-fuel-oil',
        category: 'Automotive',
        subcategory: 'Fuel',
        description: 'Kerosene and fuel oil',
        taxable: true,
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Unlike gasoline, kerosene and fuel oil ARE taxable.',
      },
    ],
  },
  {
    id: 'agriculture',
    name: 'Agriculture & Farming',
    icon: 'ðŸŒ¾',
    description: 'Agricultural products, equipment, and supplies',
    rules: [
      {
        id: 'farm-equipment',
        category: 'Agriculture & Farming',
        subcategory: 'Farm Equipment',
        description: 'Farm machinery and equipment',
        taxable: true,
        exemptionType: 'partial',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/tax-rates/',
        notes: 'Farm equipment taxed at REDUCED state rate of 1.5%. Must qualify as farm equipment.',
      },
      {
        id: 'fertilizer-pesticides',
        category: 'Agriculture & Farming',
        subcategory: 'Agricultural Inputs',
        description: 'Fertilizer, insecticides, fungicides for agricultural use',
        taxable: false,
        exemptionType: 'full',
        conditions: ['Must be used for agricultural purposes'],
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Exempt when used for agricultural purposes.',
      },
      {
        id: 'seeds',
        category: 'Agriculture & Farming',
        subcategory: 'Seeds',
        description: 'Seeds for planting purposes',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Seeds intended for planting are exempt.',
      },
      {
        id: 'livestock-feed',
        category: 'Agriculture & Farming',
        subcategory: 'Feed',
        description: 'Feed for livestock and poultry',
        taxable: false,
        exemptionType: 'full',
        conditions: ['Not including prepared dog/cat food'],
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Livestock/poultry feed is exempt. Pet food is taxable.',
      },
      {
        id: 'livestock',
        category: 'Agriculture & Farming',
        subcategory: 'Livestock',
        description: 'Sale of livestock animals',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Livestock sales are exempt from sales tax.',
      },
      {
        id: 'baby-chicks',
        category: 'Agriculture & Farming',
        subcategory: 'Poultry',
        description: 'Baby chicks and poults',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Baby chicks and poults for agricultural purposes are exempt.',
      },
    ],
  },
  {
    id: 'manufacturing',
    name: 'Manufacturing & Industry',
    icon: 'ðŸ­',
    description: 'Manufacturing equipment, pollution control, and industrial supplies',
    rules: [
      {
        id: 'manufacturing-machinery',
        category: 'Manufacturing & Industry',
        subcategory: 'Manufacturing Equipment',
        description: 'Machinery used in manufacturing',
        taxable: true,
        exemptionType: 'partial',
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/tax-rates/',
        notes: 'Manufacturing machinery taxed at REDUCED state rate of 1.5%.',
      },
      {
        id: 'pollution-control',
        category: 'Manufacturing & Industry',
        subcategory: 'Pollution Control',
        description: 'Air or water pollution control equipment',
        taxable: false,
        exemptionType: 'full',
        conditions: ['Must be primarily for pollution control'],
        tbReference: 'Ala. Code Â§ 40-23-4',
        tbUrl: 'https://www.revenue.alabama.gov/tax-incentives/sales-use-tax/',
        notes: 'Equipment primarily for pollution control is exempt.',
      },
      {
        id: 'raw-materials-resale',
        category: 'Manufacturing & Industry',
        subcategory: 'Materials for Resale',
        description: 'Materials purchased for resale or incorporation into products',
        taxable: false,
        exemptionType: 'full',
        conditions: ['Must have valid resale certificate'],
        tbReference: 'Ala. Code Â§ 40-23-1',
        tbUrl: 'https://www.revenue.alabama.gov/sales-use/sales-tax/',
        notes: 'Materials for resale exempt with valid sales tax license/resale certificate.',
      },
    ],
  },
];

export function getALCategoryById(id: string): TaxCategory | undefined {
  return AL_TAX_CATEGORIES.find(c => c.id === id);
}

export function getALRuleById(ruleId: string): TaxabilityRule | undefined {
  for (const category of AL_TAX_CATEGORIES) {
    const rule = category.rules.find(r => r.id === ruleId);
    if (rule) return rule;
  }
  return undefined;
}

export function searchALRules(query: string): TaxabilityRule[] {
  const lowerQuery = query.toLowerCase();
  const results: TaxabilityRule[] = [];

  for (const category of AL_TAX_CATEGORIES) {
    for (const rule of category.rules) {
      if (
        rule.description.toLowerCase().includes(lowerQuery) ||
        rule.category.toLowerCase().includes(lowerQuery) ||
        rule.subcategory?.toLowerCase().includes(lowerQuery) ||
        rule.notes?.toLowerCase().includes(lowerQuery)
      ) {
        results.push(rule);
      }
    }
  }

  return results;
}
