import { TaxCategory, TaxabilityRule } from '@/types/sales-tax';

export const NY_TAX_CATEGORIES: TaxCategory[] = [
  {
    id: 'clothing',
    name: 'Clothing & Footwear',
    icon: 'ðŸ‘•',
    description: 'Apparel, footwear, and related accessories',
    rules: [
      {
        id: 'clothing-under-110',
        category: 'Clothing & Footwear',
        subcategory: 'General Clothing',
        description: 'Clothing and footwear items priced under $110 per item',
        taxable: false,
        exemptionType: 'threshold',
        threshold: 110,
        tbReference: 'TB-ST-122',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/clothing_and_footwear.htm',
        notes: 'Exempt from NY State 4% tax. Local taxes may still apply - exemption depends on whether your county/city has elected to provide it. NYC and most MCTD counties provide the exemption. See Publication 718-C for locality-specific rates.',
        conditions: ['Price must be under $110 per item', 'Local exemption varies by jurisdiction'],
      },
      {
        id: 'clothing-over-110',
        category: 'Clothing & Footwear',
        subcategory: 'General Clothing',
        description: 'Clothing and footwear items priced $110 or more per item',
        taxable: true,
        tbReference: 'TB-ST-530',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/clothing_and_footwear.htm',
        notes: 'Tax applies to the full price, not just amount over $110.',
      },
      {
        id: 'protective-equipment',
        category: 'Clothing & Footwear',
        subcategory: 'Protective Equipment',
        description: 'Safety helmets, hard hats, protective goggles',
        taxable: true,
        tbReference: 'TB-ST-530',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/clothing_and_footwear.htm',
        notes: 'Not considered clothing - taxable regardless of price.',
      },
      {
        id: 'costumes',
        category: 'Clothing & Footwear',
        subcategory: 'Costumes',
        description: 'Costumes and costume accessories',
        taxable: true,
        tbReference: 'TB-ST-530',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/clothing_and_footwear.htm',
        notes: 'Costumes are taxable as they are not everyday apparel.',
      },
      {
        id: 'sports-equipment',
        category: 'Clothing & Footwear',
        subcategory: 'Sports Equipment',
        description: 'Cleated athletic shoes, ski boots, golf shoes with cleats',
        taxable: true,
        tbReference: 'TB-ST-530',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/clothing_and_footwear.htm',
        notes: 'Athletic footwear with cleats/spikes is taxable.',
      },
    ],
  },
  {
    id: 'food',
    name: 'Food & Beverages',
    icon: 'ðŸŽ',
    description: 'Food products, beverages, and restaurant meals',
    rules: [
      {
        id: 'unprepared-food',
        category: 'Food & Beverages',
        subcategory: 'Grocery Items',
        description: 'Unprepared food for home consumption (grocery items)',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-283',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/food_sold_by_food_stores.htm',
        notes: 'Most grocery items are exempt when sold for off-premises consumption.',
      },
      {
        id: 'prepared-food',
        category: 'Food & Beverages',
        subcategory: 'Prepared Food',
        description: 'Prepared food, heated food, restaurant meals',
        taxable: true,
        tbReference: 'TB-ST-806',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/food_sold_by_restaurants.htm',
        notes: 'Food sold for on-premises consumption or heated food is taxable.',
      },
      {
        id: 'candy',
        category: 'Food & Beverages',
        subcategory: 'Candy',
        description: 'Candy and confectionery items',
        taxable: true,
        tbReference: 'TB-ST-103',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/candy_and_confectionery.htm',
        notes: 'Candy is taxable regardless of where it is sold.',
      },
      {
        id: 'soft-drinks',
        category: 'Food & Beverages',
        subcategory: 'Soft Drinks',
        description: 'Soda, soft drinks, fruit drinks with less than 70% juice',
        taxable: true,
        tbReference: 'TB-ST-765',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/soft_drinks.htm',
        notes: 'Soft drinks are taxable. 100% fruit juice is exempt.',
      },
      {
        id: 'bottled-water',
        category: 'Food & Beverages',
        subcategory: 'Water',
        description: 'Bottled water',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-283',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/food_sold_by_food_stores.htm',
        notes: 'Plain bottled water is exempt.',
      },
      {
        id: 'dietary-supplements',
        category: 'Food & Beverages',
        subcategory: 'Supplements',
        description: 'Vitamins, minerals, dietary supplements',
        taxable: true,
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/dietary_foods_and_health_supplements.htm',
        notes: 'Dietary supplements are taxable unless prescribed.',
      },
    ],
  },
  {
    id: 'digital',
    name: 'Digital Products & Software',
    icon: 'ðŸ’»',
    description: 'Software, digital downloads, and streaming services',
    rules: [
      {
        id: 'prewritten-software-download',
        category: 'Digital Products & Software',
        subcategory: 'Pre-written Software',
        description: 'Pre-written (canned) software - downloaded or electronically accessed',
        taxable: true,
        tbReference: 'TB-ST-128',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/computer_software.htm',
        notes: 'Pre-written software delivered electronically is taxable.',
      },
      {
        id: 'prewritten-software-physical',
        category: 'Digital Products & Software',
        subcategory: 'Pre-written Software',
        description: 'Pre-written software on physical media (CD, USB)',
        taxable: true,
        tbReference: 'TB-ST-128',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/computer_software.htm',
        notes: 'Tangible software media is taxable.',
      },
      {
        id: 'custom-software',
        category: 'Digital Products & Software',
        subcategory: 'Custom Software',
        description: 'Custom software developed specifically for a customer',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-128',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/computer_software.htm',
        notes: 'Custom software is a service and exempt from sales tax.',
      },
      {
        id: 'saas',
        category: 'Digital Products & Software',
        subcategory: 'SaaS',
        description: 'Software as a Service (SaaS) subscriptions',
        taxable: true,
        conditions: ['Must be pre-written software', 'Accessed remotely'],
        tbReference: 'TB-ST-128',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/computer_software.htm',
        notes: 'SaaS using pre-written software is generally taxable in NY.',
      },
      {
        id: 'streaming-entertainment',
        category: 'Digital Products & Software',
        subcategory: 'Streaming',
        description: 'Video streaming services (Netflix, Hulu, etc.)',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-273',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/entertainment.htm',
        notes: 'Streaming video entertainment services are exempt.',
      },
      {
        id: 'digital-music',
        category: 'Digital Products & Software',
        subcategory: 'Digital Downloads',
        description: 'Digital music downloads',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-273',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/entertainment.htm',
        notes: 'Digital music and audio downloads are exempt.',
      },
      {
        id: 'ebooks',
        category: 'Digital Products & Software',
        subcategory: 'Digital Downloads',
        description: 'E-books and digital publications',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-746',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/publications.htm',
        notes: 'E-books are exempt like their physical counterparts.',
      },
    ],
  },
  {
    id: 'medical',
    name: 'Medical & Health',
    icon: 'ðŸ’Š',
    description: 'Prescription drugs, medical devices, and health products',
    rules: [
      {
        id: 'prescription-drugs',
        category: 'Medical & Health',
        subcategory: 'Prescription Drugs',
        description: 'Prescription medications',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/drugs_and_medicines.htm',
        notes: 'Prescription drugs are fully exempt.',
      },
      {
        id: 'otc-drugs',
        category: 'Medical & Health',
        subcategory: 'OTC Medications',
        description: 'Over-the-counter medications (aspirin, cold medicine)',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/drugs_and_medicines.htm',
        notes: 'OTC drugs and medicines are exempt in NY.',
      },
      {
        id: 'medical-equipment',
        category: 'Medical & Health',
        subcategory: 'Medical Equipment',
        description: 'Durable medical equipment (wheelchairs, crutches)',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Used to correct or alleviate physical incapacity'],
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/drugs_and_medicines.htm',
        notes: 'Exempt when used for medical purposes.',
      },
      {
        id: 'prosthetics',
        category: 'Medical & Health',
        subcategory: 'Prosthetics',
        description: 'Prosthetic devices and artificial limbs',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/drugs_and_medicines.htm',
        notes: 'Prosthetic aids are exempt.',
      },
      {
        id: 'cosmetics',
        category: 'Medical & Health',
        subcategory: 'Cosmetics',
        description: 'Cosmetics, toiletries, beauty products',
        taxable: true,
        tbReference: 'TB-ST-193',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/drugs_and_medicines.htm',
        notes: 'Cosmetics and toiletries are taxable.',
      },
    ],
  },
  {
    id: 'services',
    name: 'Services',
    icon: 'ðŸ”§',
    description: 'Professional, personal, and business services',
    rules: [
      {
        id: 'professional-services',
        category: 'Services',
        subcategory: 'Professional Services',
        description: 'Legal, accounting, consulting services',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-875',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/taxable_and_exempt_services.htm',
        notes: 'Most professional services are not subject to sales tax.',
      },
      {
        id: 'repair-services',
        category: 'Services',
        subcategory: 'Repair Services',
        description: 'Repair and maintenance of tangible personal property',
        taxable: true,
        tbReference: 'TB-ST-875',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/taxable_and_exempt_services.htm',
        notes: 'Repair services for tangible property are generally taxable.',
      },
      {
        id: 'installation-services',
        category: 'Services',
        subcategory: 'Installation',
        description: 'Installation of tangible personal property',
        taxable: true,
        tbReference: 'TB-ST-875',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/taxable_and_exempt_services.htm',
        notes: 'Installation charges are taxable when part of a taxable sale.',
      },
      {
        id: 'information-services',
        category: 'Services',
        subcategory: 'Information Services',
        description: 'Information services, data processing',
        taxable: true,
        tbReference: 'TB-ST-879',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/information_services.htm',
        notes: 'Information services furnished to customers are taxable.',
      },
      {
        id: 'parking-services',
        category: 'Services',
        subcategory: 'Parking',
        description: 'Parking, garaging, storing motor vehicles in NYC',
        taxable: true,
        tbReference: 'TB-ST-580',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/parking_services.htm',
        notes: 'Parking in NYC is subject to state and city tax.',
      },
    ],
  },
  {
    id: 'manufacturing',
    name: 'Manufacturing & Industry',
    icon: 'ðŸ­',
    description: 'Manufacturing equipment, raw materials, and industrial supplies',
    rules: [
      {
        id: 'manufacturing-equipment',
        category: 'Manufacturing & Industry',
        subcategory: 'Equipment',
        description: 'Machinery and equipment used in manufacturing',
        taxable: false,
        exemptionType: 'conditional',
        conditions: ['Used directly in production', 'Qualifies under Tax Law Section 1115(a)(12)'],
        tbReference: 'TB-ST-176',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/manufacturing_equipment.htm',
        notes: 'Exempt when used directly and predominantly in production.',
      },
      {
        id: 'raw-materials',
        category: 'Manufacturing & Industry',
        subcategory: 'Raw Materials',
        description: 'Raw materials for manufacturing',
        taxable: false,
        exemptionType: 'full',
        tbReference: 'TB-ST-740',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/resale_exemption.htm',
        notes: 'Materials that become part of finished product are exempt.',
      },
      {
        id: 'utilities-manufacturing',
        category: 'Manufacturing & Industry',
        subcategory: 'Utilities',
        description: 'Gas, electricity used in manufacturing',
        taxable: false,
        exemptionType: 'partial',
        tbReference: 'TB-ST-917',
        tbUrl: 'https://www.tax.ny.gov/pubs_and_bulls/tg_bulletins/st/utilities.htm',
        notes: 'Utilities used in production may qualify for exemption.',
      },
    ],
  },
];

export function getCategoryById(id: string): TaxCategory | undefined {
  return NY_TAX_CATEGORIES.find(c => c.id === id);
}

export function getRuleById(ruleId: string): TaxabilityRule | undefined {
  for (const category of NY_TAX_CATEGORIES) {
    const rule = category.rules.find(r => r.id === ruleId);
    if (rule) return rule;
  }
  return undefined;
}

export function searchRules(query: string): TaxabilityRule[] {
  const lowerQuery = query.toLowerCase();
  const results: TaxabilityRule[] = [];

  for (const category of NY_TAX_CATEGORIES) {
    for (const rule of category.rules) {
      if (
        rule.description.toLowerCase().includes(lowerQuery) ||
        rule.category.toLowerCase().includes(lowerQuery) ||
        rule.subcategory?.toLowerCase().includes(lowerQuery) ||
        rule.notes?.toLowerCase().includes(lowerQuery)
      ) {
        results.push(rule);
      }
    }
  }

  return results;
}
